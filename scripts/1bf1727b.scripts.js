(function(){var a,b,c;c={"127.0.0.1":"ihhjajakpgbadlhnjdhmpahjpajpoeoi","slaypni.github.io":"klhmcnkgigddgihjcddalhaehcpinkjn"},a=angular.module("FlashwardApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider","isBrowserExtension",function(a,b,c){return a.state("welcome",{templateUrl:"views/welcome.html"}).state("main",{"abstract":!0,template:"<main-navbar></main-navbar><ui-view></ui-view>"}).state("main.flash",{template:"<flash></flash>",data:{isDemo:!1}}).state("main.settings",{url:"/settings",templateUrl:"views/settings.html",controller:"SettingsCtrl as settings"}).state("main.flash-demo",{url:"/demo",template:"<flash></flash>",data:{isDemo:!0}}),b.when("",["$state",function(a){return a.go(c?"main.flash":"welcome"),!0}]).otherwise("")}]).run(["$rootScope","$location","$window",function(a,b,c){return a.$on("$routeChangeSuccess",function(){var a;return null!=(a=c._gaq)?a.push(["_trackPageview",b.path()]):void 0}),c.addEventListener("keydown",function(b){return a.$broadcast("keydown",b)}),a.$window=c}]).constant("chromeExtensionId",c[window.location.hostname]),(b=function(b){var d,e;return null!=(null!=(d=window.chrome)&&null!=(e=d.runtime)?e.sendMessage:void 0)?window.chrome.runtime.sendMessage(c[window.location.hostname],{method:"ping"},function(c){return a.constant("isBrowserExtension",c===!0),b()}):(a.constant("isBrowserExtension",!1),b())})(function(){return angular.element(document).ready(function(){return angular.bootstrap(document,["FlashwardApp"])})})}).call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};angular.module("FlashwardApp").controller("SettingsCtrl",["$timeout","$window","browserExtension","isBrowserExtension",function(){function c(b,c,d,e){this.save=a(this.save,this),this.load=a(this.load,this),this.$window=c,this.$timeout=b,this.isBrowserExtension=e,this.isBrowserExtension&&(this.browserExtension=d,this.hosts=[],this.load())}return c.prototype.load=function(){return this.browserExtension.formulaNames(function(a){return function(c){return a.browserExtension.omittedHostnames(function(d){return a.$timeout(function(){var e,f,g,h;for(h=[],f=0,g=c.length;g>f;f++)e=c[f],h.push(a.hosts.push({name:e,isOmitted:b.call(d,e)>=0}));return h})})}}(this))},c.prototype.save=function(){var a;return this.browserExtension.setOmittedHostnames(function(){var b,c,d,e;for(d=this.hosts.filter(function(){return function(a){return a.isOmitted}}(this)),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.name);return e}.call(this))},c}()])}.call(this),function(){angular.module("FlashwardApp").directive("mainNavbar",function(){return{restrict:"E",transclude:!1,scope:{},templateUrl:"views/main-navbar.html",link:function(a,b){return $("body").addClass("main-navbar-exist"),$("body").trigger("cssClassChanged"),b.on("$destroy",function(){return $("body").removeClass("main-navbar-exist"),$("body").trigger("cssClassChanged")})}}})}.call(this),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},b=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("FlashwardApp").directive("flash",["$timeout","$window","$sce",function(c,d,e){return{restrict:"E",transclude:!1,scope:{},templateUrl:"views/flash.html",link:function(b,e,f,g){var h,i,j,k,l,m,n,o;return i=e.find(".flash .card .inner"),l=i.height(),b.shrunkCardHeight=k=e.find(".flash .ghost .inner.stuck.shrunk").height(),e.find(".outer").height(l),h=function(){return parseInt($("body").css("padding-top"))},o=function(){return b.viewHeight=$(d).height()-h(),b.refHeight=b.viewHeight-k},j=void 0,n=function(){var c;return a.call(i.attr("class").split(" "),"stuck")<0&&(j=i.offset().top),c=Math.max(0,h()+$(d).scrollTop()-j),b.isStuck=c>0,b.cardHeight=Math.max(l-c,k)},m=function(){return c(function(){return o(),n(),g.isRef||null==g.url?void 0:g.isRef=$(d).scrollTop()+$(window).height()>$(".ref").offset().top})},m(),$("body").on("cssClassChanged",m),$(d).resize(m),$(d).scroll(m),b.$watch("flash.item",m),e.on("$destroy",function(){return $("body").off("cssClassChanged",m),$(d).off("resize",m),$(d).off("scroll",m)}),b.onTitleClicked=function(){return $(d).scrollTop()+$(d).height()>$(".ref").offset().top?$("html, body").animate({scrollTop:0},200):$("html, body").animate({scrollTop:$(".ref").offset().top-h()},200),!0},b.isGradesFiltered=!(!1===JSON.parse(d.localStorage.getItem("flash.isGradesFiltered"))),b.setIfGradesFiltered=function(a){return d.localStorage.setItem("flash.isGradesFiltered",JSON.stringify(a)),b.isGradesFiltered=a},b.scheduledDateString=function(){var a,b,c,d;return null==g.item?"":(b=g.item.dueDate-new Date,0>b?"":(a=Math.ceil(b/864e5),a>1?""+a+" "+(1===a?"day":"days"):(c=Math.ceil(b/36e5),c>1?""+c+" "+(1===c?"hour":"hours"):(d=Math.ceil(b/6e4),""+d+" "+(1>=d?"minute":"minutes")))))},b.$on("keydown",function(a,c){var e,f,h,i,j;return h=c.which,j=c.shiftKey,i=c.metaKey,f=c.ctrlKey,e=c.altKey,i===f&&f===e&&e===!1&&(!j&&h>=48&&53>=h&&g.answer(h-48,!0),j||71!==h||g.answer(4,!0),j||66!==h||g.answer(1,!0),j||68!==h||g.discard(),j||82!==h||b.onTitleClicked(),g.url&&!j&&85===h&&(d.location.href=g.url),j&&191===h)?$("#flashHelp").modal():void 0})},controller:["SMWrapper","SMWrapperMock","$state",function(){function a(a,c,d){this.setIfAdvanceable=b(this.setIfAdvanceable,this),this.discard=b(this.discard,this),this.answer=b(this.answer,this),this.next=b(this.next,this),d.current.data.isDemo===!0&&(a=c),this.title="Â ",this.isRef=!1,this.isLoaded=!1,a.load(function(a){return function(b){return a.smw=b,a.isLoaded=!0,a.setIfAdvanceable(!1),a.next()}}(this))}return a.prototype.next=function(a){var b,d;return null==a&&(a=!1),a&&(this.item=null),b=this.nextSnappedItem||(null!=(d=this.smw)?d.nextItem:void 0),"function"==typeof b?b(function(a){return function(b){return null==b&&null!=a.nextSnappedItem?(a.nextSnappedItem=null,a.next()):c(function(){return a.isRef=!1,a.title=a.url=null,a.isPlannedItem=null!=b&&b!==a.item,a.item=b,a.isAdvance=null!=a.item&&new Date<a.item.dueDate,a.isPlannedItem=a.isPlannedItem&&(a.isAdvanceable===!0||a.isAdvance===!1),a.isPlannedItem?a.isAdvance&&null==a.nextSnappedItem?a.smw.snapshot(function(b){return a.nextSnappedItem=b,a.next(!0)}):(a.title=a.item.value.title,a.url=a.item.value.urls.length>0?e.trustAsResourceUrl(a.item.value.urls.slice(-1)[0]):null):void 0})}}(this)):void 0},a.prototype.answer=function(a,b){var c;return null==b&&(b=!1),this.isPlannedItem?(b&&$(d).scrollTop()>0&&$("html, body").animate({scrollTop:0},200),null!=(c=this.smw)?c.answer(a,this.item,function(a){return function(){return a.next()}}(this)):void 0):void 0},a.prototype.discard=function(){var a;if(this.isPlannedItem)return null!=(a=this.smw)?a.removeItem(this.item,function(a){return function(){return a.next()}}(this)):void 0},a.prototype.setIfAdvanceable=function(a){return a&&!this.isAdvanceable&&this.isAdvance?this.smw.snapshot(function(a){return function(b){return a.nextSnappedItem=b,a.next(!0)}}(this)):a||(this.nextSnappedItem=null,this.isAdvance&&(this.isPlannedItem=!1,this.next())),this.isAdvanceable=a},a}()],controllerAs:"flash"}}])}.call(this),function(){angular.module("FlashwardApp").factory("browserExtension",["$window","$rootScope","chromeExtensionId",function(a,b,c){return{formulaNames:function(b){return a.chrome.runtime.sendMessage(c,{method:"getFormulaNames"},b)},ids:function(b,d){return a.chrome.runtime.sendMessage(c,{method:"getItemIdsByLastVisitTimeLowerBound",lastVisitTime:b},d)},item:function(b,d){return a.chrome.runtime.sendMessage(c,{method:"getItemById",id:b},d)},omittedHostnames:function(b){return a.chrome.runtime.sendMessage(c,{method:"getOmittedHostnames"},b)},setOmittedHostnames:function(b,d){return null==d&&(d=void 0),a.chrome.runtime.sendMessage(c,{method:"setOmittedHostnames",hostnames:b},d)},removeItem:function(b){return a.chrome.runtime.sendMessage(c,{method:"removeItemById",id:b})}}}])}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};angular.module("FlashwardApp").factory("SMWrapper",["browserExtension",function(b){var d;return d=function(){function d(b,c){var d;this.name=c,this.snapshot=a(this.snapshot,this),this._saveSM=a(this._saveSM,this),this._saveItem=a(this._saveItem,this),this.removeItem=a(this.removeItem,this),this.answer=a(this.answer,this),this.nextItem=a(this.nextItem,this),this._wipeZombieItems=a(this._wipeZombieItems,this),this._loadItems=a(this._loadItems,this),this._prepareItem=a(this._prepareItem,this),this._prepareSM=a(this._prepareSM,this),d=indexedDB.open(this.name,1),d.onsuccess=function(a){return function(){return a.db=d.result,a.db.onerror=function(b){return console.error(""+a.name+" database error ("+b.target.name+"): "+b.target.message)},a._prepareSM(b)}}(this),d.onerror=function(){return function(){return console.error("Error loading Inventory database.")}}(this),d.onupgradeneeded=function(a){return function(b){var c,d;return a.db=b.target.result,d=a.db.createObjectStore("sm"),c=a.db.createObjectStore("items",{keyPath:"value"}),c.createIndex("dueDate, answeredDate",["dueDate","answeredDate"],{unique:!1})}}(this),d.onblocked=function(){return function(){return console.log("Please close all other tabs with this site open!")}}(this),d.onversionchange=function(a){return function(){return a.db.close(),console.log("A new version of this page is ready. Please reload!")}}(this)}return d.load=function(a,b){return null==b&&(b="default"),new d(a,b)},d.prototype._prepareSM=function(a){var b,c;return c=this.db.transaction(["sm"],"readonly"),b=c.objectStore("sm"),b.get("sm").onsuccess=function(b){return function(c){return b.sm=null!=c.target.result?SM.load(c.target.result):new SM,b.sm.intervalBase=432e5,b._prepareItem(),b._loadItems(0,a)}}(this)},d.prototype._prepareItem=function(){var b,d;return this.sm.addItem(null),d=this.sm.q[0],this.sm.discard(d),b=d.constructor,this.Item=function(d){function e(b,c){this.data=a(this.data,this),e.__super__.constructor.call(this,b,c),this.answeredDate=new Date(0)}return c(e,d),e.prototype.data=function(){var a;return a=e.__super__.data.call(this),a.answeredDate=this.answeredDate,a},e.load=function(a,c){var d,f,g,h,i;g=b.load(a,c),d=new e(a),i=g.data();for(f in i)h=i[f],d[f]=h;return d.answeredDate=new Date(c.answeredDate),d},e}(b)},d.prototype._loadItems=function(a,c){return null==a&&(a=0),null==c&&(c=void 0),b.ids(a,function(a){return function(b){return a._wipeZombieItems(b,function(d){var e,f,g,h,i,j,k;if(b=b.filter(function(a){return-1===_.indexOf(d,a,!0)}),b.length){for(h=a.db.transaction(["items"],"readwrite"),h.oncomplete=function(){return"function"==typeof c?c(a):void 0},g=h.objectStore("items"),f=new a.Item(a.sm,null),k=[],i=0,j=b.length;j>i;i++)e=b[i],f.value=e,k.push(g.add(f.data()).onerror=function(a){return"ConstraintError"===a.target.error.name&&a.stopPropagation(),!1});return k}return"function"==typeof c?c(a):void 0})}}(this))},d.prototype._wipeZombieItems=function(a,b){var c,d,e;return null==b&&(b=void 0),a=a.concat().sort(function(a,b){return a-b}),e=this.db.transaction(["items"],"readwrite"),d=e.objectStore("items"),c=[],d.openCursor().onsuccess=function(){return function(e){var f,g;return f=e.target.result,f?(g=f.key,-1===_.indexOf(a,g,!0)?d["delete"](g):c.push(g),f["continue"]()):"function"==typeof b?b(c):void 0}}(this)},d.prototype.nextItem=function(a){var c,d;return d=this.db.transaction(["items"],"readonly"),c=d.objectStore("items"),c.index("dueDate, answeredDate").openCursor().onsuccess=function(c){return function(d){var e,f;return e=d.target.result,null==e?a(null):(f=c.Item.load(c.sm,e.value),f.id=f.value,b.item(f.id,function(b){return f.value=b,a(f)}))}}(this)},d.prototype.answer=function(a,b,c){return null==c&&(c=void 0),this.sm._update(a,b),this._saveSM(),b.answeredDate=new Date,this._saveItem(b,c)},d.prototype.removeItem=function(a,c){var d,e,f;return null==c&&(c=void 0),b.removeItem(a.id),f=this.db.transaction(["items"],"readwrite"),d=f.objectStore("items"),e=d["delete"](a.id),null!=c?f.oncomplete=c:void 0},d.prototype._saveItem=function(a,b){var c,d,e,f;return null==b&&(b=void 0),e=this.db.transaction(["items"],"readwrite"),c=e.objectStore("items"),f=a.value,a.value=a.id,d=c.put(a.data()),a.value=f,null!=b?e.oncomplete=b:void 0},d.prototype._saveSM=function(a){var b,c,d;return null==a&&(a=void 0),d=this.db.transaction(["sm"],"readwrite"),b=d.objectStore("sm"),c=b.put(this.sm.data(),"sm"),null!=a?d.oncomplete=a:void 0},d.prototype.snapshot=function(a){var c,d,e;return c=[],d=function(e){return function(f){var g,h,i;return g=c.shift(),null==g?a(void 0):(h=e.db.transaction(["items"],"readonly").objectStore("items"),i=h.get(g),i.onsuccess=function(a){var c;return c=e.Item.load(e.sm,a.target.result),c.id=c.value,b.item(c.id,function(a){return c.value=a,f(c)})},i.onerror=function(a){return"DataError"===a.target.error.name&&a.stopPropagation(),d()})}}(this),e=this.db.transaction(["items"],"readonly").objectStore("items"),e.index("dueDate, answeredDate").openCursor().onsuccess=function(){return function(b){var e;return e=b.target.result,e?(c.push(e.value.value),e["continue"]()):a(d)}}(this)},d}()}])}.call(this),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};angular.module("FlashwardApp").factory("SMWrapperMock",function(){var c;return c=function(){function c(c){this.snapshot=b(this.snapshot,this),this.removeItem=b(this.removeItem,this),this.answer=b(this.answer,this),this.nextItem=b(this.nextItem,this);var d,e,f;for(this.sm=new SM,this.sm.intervalBase=432e5,e=0,f=a.length;f>e;e++)d=a[e],this.sm.addItem(d);c(this)}return c.load=function(a){return new c(a)},c.prototype.nextItem=function(a){return a(this.sm.nextItem(!0))},c.prototype.answer=function(a,b,c){return null==c&&(c=void 0),this.sm.answer(a,b),"function"==typeof c?c():void 0},c.prototype.removeItem=function(a,b){return null==b&&(b=void 0),this.sm.discard(a),"function"==typeof b?b():void 0},c.prototype.snapshot=function(a){var b;return b=this.sm.q.concat(),a(function(a){return a(b.shift())})},c}()}),a=[{title:"word",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/word_1"]},{title:"is",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/is_2"]},{title:"automatically",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/automatic_1"]},{title:"put",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/put"]},{title:"to",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/to_1"]},{title:"inventory",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/inventory_1"]},{title:"when",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/when_1"]},{title:"you",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/you"]},{title:"visit",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/visit_1"]},{title:"online",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/online"]},{title:"dictionary",urls:["http://www.oxfordlearnersdictionaries.com/us/definition/english/dictionary"]}]}.call(this),function(){var FI_G,ForgettingCurves,Item,MAX_AF,MAX_GRADE,MIN_AF,NOTCH_AF,OFM,RANGE_AF,RANGE_REPETITION,RFM,THRESHOLD_RECALL,error,exponentialRegression,fixedPointPowerLawRegression,linearRegression,linearRegressionThroughOrigin,main,mse,powerLawModel,powerLawRegression,sum,__bind=function(a,b){return function(){return a.apply(b,arguments)}};this.SM=function(){function a(){this.data=__bind(this.data,this),this.discard=__bind(this.discard,this),this._update=__bind(this._update,this),this.answer=__bind(this.answer,this),this.nextItem=__bind(this.nextItem,this),this.addItem=__bind(this.addItem,this),this._findIndexToInsert=__bind(this._findIndexToInsert,this),this.requestedFI=10,this.intervalBase=108e5,this.q=[],this.fi_g=new FI_G(this),this.forgettingCurves=new ForgettingCurves(this),this.rfm=new RFM(this),this.ofm=new OFM(this)}return a.prototype._findIndexToInsert=function(a,b){var c,d,e;return null==b&&(b=function(){e=[];for(var a=0,b=this.q.length;b>=0?b>a:a>b;b>=0?a++:a--)e.push(a);return e}.apply(this)),0===b.length?0:(d=a.dueDate,c=Math.floor(b.length/2),1===b.length?d<this.q[b[c]].dueDate?b[c]:b[c]+1:this._findIndexToInsert(a,d<this.q[b[c]].dueDate?b.slice(0,c):b.slice(c)))},a.prototype.addItem=function(a){var b;return b=new Item(this,a),this.q.splice(this._findIndexToInsert(b),0,b)},a.prototype.nextItem=function(a){return null==a&&(a=!1),0===this.q.length?null:a||this.q[0].dueDate<new Date?this.q[0]:null},a.prototype.answer=function(a,b,c){return null==c&&(c=new Date),this._update(a,b,c),this.discard(b),this.q.splice(this._findIndexToInsert(b),0,b)},a.prototype._update=function(a,b,c){return null==c&&(c=new Date),b.repetition>=0&&(this.forgettingCurves.registerPoint(a,b,c),this.ofm.update(),this.fi_g.update(a,b,c)),b.answer(a,c)},a.prototype.discard=function(a){var b;return b=this.q.indexOf(a),b>=0?this.q.splice(b,1):void 0},a.prototype.data=function(){var a;return{requestedFI:this.requestedFI,intervalBase:this.intervalBase,q:function(){var b,c,d,e;for(d=this.q,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.data());return e}.call(this),fi_g:this.fi_g.data(),forgettingCurves:this.forgettingCurves.data(),version:1}},a.load=function(b){var c,d;return d=new a,d.requestedFI=b.requestedFI,d.intervalBase=b.intervalBase,d.q=function(){var a,e,f,g;for(f=b.q,g=[],a=0,e=f.length;e>a;a++)c=f[a],g.push(Item.load(d,c));return g}(),d.fi_g=FI_G.load(d,b.fi_g),d.forgettingCurves=ForgettingCurves.load(d,b.forgettingCurves),d.ofm.update(),d},a}(),RANGE_AF=20,RANGE_REPETITION=20,MIN_AF=1.2,NOTCH_AF=.3,MAX_AF=MIN_AF*NOTCH_AF*(RANGE_AF-1),MAX_GRADE=5,THRESHOLD_RECALL=3,Item=function(){function a(a,b){this.sm=a,this.value=b,this.data=__bind(this.data,this),this.answer=__bind(this.answer,this),this._updateAF=__bind(this._updateAF,this),this._I=__bind(this._I,this),this.afIndex=__bind(this.afIndex,this),this.af=__bind(this.af,this),this.uf=__bind(this.uf,this),this.interval=__bind(this.interval,this),this.lapse=0,this.repetition=-1,this.of=1,this.optimumInterval=this.sm.intervalBase,this.dueDate=new Date(0),this._afs=[]}var b;return b=30,a.prototype.interval=function(a){return null==a&&(a=new Date),null==this.previousDate?this.sm.intervalBase:a-this.previousDate},a.prototype.uf=function(a){return null==a&&(a=new Date),this.interval(a)/(this.optimumInterval/this.of)},a.prototype.af=function(a){var b;return null==a&&(a=void 0),null==a?this._af:(b=Math.round((a-MIN_AF)/NOTCH_AF),this._af=Math.max(MIN_AF,Math.min(MAX_AF,MIN_AF+b*NOTCH_AF)))},a.prototype.afIndex=function(){var a,b,c;return a=function(){var a,c;for(c=[],b=a=0;RANGE_AF>=0?RANGE_AF>a:a>RANGE_AF;b=RANGE_AF>=0?++a:--a)c.push(MIN_AF+b*NOTCH_AF);return c}(),function(){c=[];for(var a=0;RANGE_AF>=0?RANGE_AF>a:a>RANGE_AF;RANGE_AF>=0?a++:a--)c.push(a);return c}.apply(this).reduce(function(b){return function(c,d){return Math.abs(b.af()-a[c])<Math.abs(b.af()-a[d])?c:d}}(this))},a.prototype._I=function(a){var b;return null==a&&(a=new Date),b=this.sm.ofm.of(this.repetition,0===this.repetition?this.lapse:this.afIndex()),this.of=Math.max(1,(b-1)*(this.interval(a)/this.optimumInterval)+1),this.optimumInterval=Math.round(this.optimumInterval*this.of),this.previousDate=a,this.dueDate=new Date(a.getTime()+this.optimumInterval)},a.prototype._updateAF=function(a,c){var d,e,f,g;return null==c&&(c=new Date),f=Math.max(1,this.sm.fi_g.fi(a)),d=this.uf(c)*(this.sm.requestedFI/f),e=this.repetition>0?this.sm.ofm.af(this.repetition,d):Math.max(MIN_AF,Math.min(MAX_AF,d)),this._afs.push(e),this._afs=this._afs.slice(Math.max(0,this._afs.length-b)),this.af(sum(this._afs.map(function(a,b){return a*(b+1)}))/sum(function(){g=[];for(var a=1,b=this._afs.length;b>=1?b>=a:a>=b;b>=1?a++:a--)g.push(a);return g}.apply(this)))},a.prototype.answer=function(a,b){return null==b&&(b=new Date),this.repetition>=0&&this._updateAF(a,b),a>=THRESHOLD_RECALL?(this.repetition<RANGE_REPETITION-1&&this.repetition++,this._I(b)):(this.lapse<RANGE_AF-1&&this.lapse++,this.optimumInterval=this.sm.intervalBase,this.previousDate=null,this.dueDate=b,this.repetition=-1)},a.prototype.data=function(){return{value:this.value,repetition:this.repetition,lapse:this.lapse,of:this.of,optimumInterval:this.optimumInterval,dueDate:this.dueDate,previousDate:this.previousDate,_afs:this._afs}},a.load=function(b,c){var d,e,f;d=new a(b);for(e in c)f=c[e],d[e]=f;return d.dueDate=new Date(d.dueDate),null!=d.previousDate&&(d.previousDate=new Date(d.previousDate)),d},a}(),FI_G=function(){function a(a,b){var c,d,e,f;if(this.sm=a,this.points=null!=b?b:void 0,this.data=__bind(this.data,this),this.grade=__bind(this.grade,this),this.fi=__bind(this.fi,this),this.update=__bind(this.update,this),this._registerPoint=__bind(this._registerPoint,this),null==this.points)for(this.points=[],f=[[0,MAX_GRADE],[100,0]],d=0,e=f.length;e>d;d++)c=f[d],this._registerPoint(c[0],c[1])}var b,c;return c=5e3,b=1,a.prototype._registerPoint=function(a,d){return this.points.push([a,d+b]),this.points=this.points.slice(Math.max(0,this.points.length-c))},a.prototype.update=function(a,b,c){var d;return null==c&&(c=new Date),d=function(a){return function(){return b.uf(c)/b.of*a.sm.requestedFI}}(this),this._registerPoint(d(),a),this._graph=null},a.prototype.fi=function(a){var c;return null==this._graph&&(this._graph=exponentialRegression(this.points)),Math.max(0,Math.min(100,null!=(c=this._graph)?c.x(a+b):void 0))},a.prototype.grade=function(a){var c;return null==this._graph&&(this._graph=exponentialRegression(this.points)),(null!=(c=this._graph)?c.y(a):void 0)-b},a.prototype.data=function(){return{points:this.points}},a.load=function(b,c){return new a(b,c.points)},a}(),ForgettingCurves=function(){function a(a,b){var e,f,g,h,i;this.sm=a,null==b&&(b=void 0),this.data=__bind(this.data,this),this.registerPoint=__bind(this.registerPoint,this),this.curves=function(){var a,j;for(j=[],i=a=0;RANGE_REPETITION>=0?RANGE_REPETITION>a:a>RANGE_REPETITION;i=RANGE_REPETITION>=0?++a:--a)j.push(function(){var a,j;for(j=[],e=a=0;RANGE_AF>=0?RANGE_AF>a:a>RANGE_AF;e=RANGE_AF>=0?++a:--a)h=null!=b?b[i][e]:(g=i>0?function(){var a,b;for(b=[],f=a=0;20>=a;f=++a)b.push([MIN_AF+NOTCH_AF*f,Math.min(d,Math.exp(-(i+1)/200*(f-e*Math.sqrt(2/(i+1))))*(d-this.sm.requestedFI))]);return b}.call(this):function(){var a,b;for(b=[],f=a=0;20>=a;f=++a)b.push([MIN_AF+NOTCH_AF*f,Math.min(d,Math.exp(-1/(10+1*(e+1))*(f-Math.pow(e,.6)))*(d-this.sm.requestedFI))]);return b}.call(this),[[0,d]].concat(g)),j.push(new c(h));return j}.call(this));return j}.call(this)}var b,c,d;return b=1,d=100+b,a.prototype.registerPoint=function(a,b,c){var d;return null==c&&(c=new Date),d=b.repetition>0?b.afIndex():b.lapse,this.curves[b.repetition][d].registerPoint(a,b.uf(c))},a.prototype.data=function(){var a,b;return{points:function(){var c,d;for(d=[],b=c=0;RANGE_REPETITION>=0?RANGE_REPETITION>c:c>RANGE_REPETITION;b=RANGE_REPETITION>=0?++c:--c)d.push(function(){var c,d;for(d=[],a=c=0;RANGE_AF>=0?RANGE_AF>c:c>RANGE_AF;a=RANGE_AF>=0?++c:--c)d.push(this.curves[b][a].points);return d}.call(this));return d}.call(this)}},a.load=function(b,c){return new a(b,c.points)},c=function(){function a(a){this.points=a,this.uf=__bind(this.uf,this),this.retention=__bind(this.retention,this),this.registerPoint=__bind(this.registerPoint,this)}var c;return c=500,a.prototype.registerPoint=function(a,e){var f;return f=a>=THRESHOLD_RECALL,this.points.push([e,f?d:b]),this.points=this.points.slice(Math.max(0,this.points.length-c)),this._curve=null},a.prototype.retention=function(a){return null==this._curve&&(this._curve=exponentialRegression(this.points)),Math.max(b,Math.min(this._curve.y(a),d))-b},a.prototype.uf=function(a){return null==this._curve&&(this._curve=exponentialRegression(this.points)),Math.max(0,this._curve.x(a+b))},a}(),a}(),RFM=function(){function a(a){this.sm=a,this.rf=__bind(this.rf,this)}return a.prototype.rf=function(a,b){return this.sm.forgettingCurves.curves[a][b].uf(100-this.sm.requestedFI)},a}(),OFM=function(){function a(a){this.sm=a,this.af=__bind(this.af,this),this.of=__bind(this.of,this),this.update=__bind(this.update,this),this.update()}var b,c,d;return b=1,c=function(a){return a*NOTCH_AF+MIN_AF},d=function(a){return a+b},a.prototype.update=function(){var a,e,f,g,h;return f=function(){var b,e;for(e=[],a=b=0;RANGE_AF>=0?RANGE_AF>b:b>RANGE_AF;a=RANGE_AF>=0?++b:--b)e.push(fixedPointPowerLawRegression(function(){var b,c;for(c=[],h=b=1;RANGE_REPETITION>=1?RANGE_REPETITION>b:b>RANGE_REPETITION;h=RANGE_REPETITION>=1?++b:--b)c.push([d(h),this.sm.rfm.rf(h,a)]);return c}.call(this),[d(1),c(a)]).b);return e}.call(this),f=function(){var b,d;for(d=[],a=b=0;RANGE_AF>=0?RANGE_AF>b:b>RANGE_AF;a=RANGE_AF>=0?++b:--b)d.push(c(a)/Math.pow(2,f[a]));return d}(),e=linearRegression(function(){var b,c;for(c=[],a=b=0;RANGE_AF>=0?RANGE_AF>b:b>RANGE_AF;a=RANGE_AF>=0?++b:--b)c.push([a,f[a]]);return c}()),this._ofm=function(a){var f,g,h;return f=c(a),g=Math.log(f/e.y(a))/Math.log(d(1)),h=powerLawModel(f/Math.pow(d(1),g),g),{y:function(a){return h.y(d(a))},x:function(a){return h.x(a)-b}}},g=exponentialRegression(function(){var b,c;for(c=[],a=b=0;RANGE_AF>=0?RANGE_AF>b:b>RANGE_AF;a=RANGE_AF>=0?++b:--b)c.push([a,this.sm.rfm.rf(0,a)]);return c}.call(this)),this._ofm0=function(a){return g.y(a)}},a.prototype.of=function(a,b){return 0===a?"function"==typeof this._ofm0?this._ofm0(b):void 0:"function"==typeof this._ofm?this._ofm(b).y(a):void 0},a.prototype.af=function(a,b){var d;return c(function(){d=[];for(var a=0;RANGE_AF>=0?RANGE_AF>a:a>RANGE_AF;RANGE_AF>=0?a++:a--)d.push(a);return d}.apply(this).reduce(function(c){return function(d,e){return Math.abs(c.of(a,d)-b)<Math.abs(c.of(a,e)-b)?d:e}}(this)))},a}(),sum=function(a){return a.reduce(function(a,b){return a+b})},mse=function(a,b){var c;return sum(function(){var d,e,f;for(f=[],c=d=0,e=b.length;e>=0?e>d:d>e;c=e>=0?++d:--d)f.push(Math.pow(a(b[c][0])-b[c][1],2));return f}())/b.length},exponentialRegression=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return h=a.length,b=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)i=a[b],d.push(i[0]);return d}(),c=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)i=a[b],d.push(i[1]);return d}(),g=c.map(Math.log),k=b.map(function(a){return a*a}),l=sum(g),m=sum(k),n=sum(b),o=sum(function(){var a,c;for(c=[],f=a=0;h>=0?h>a:a>h;f=h>=0?++a:--a)c.push(b[f]*g[f]);return c}()),j=n*n,d=(l*m-n*o)/(h*m-j),e=(h*o-n*l)/(h*m-j),p=function(a){return Math.exp(d)*Math.exp(e*a)},{y:p,x:function(a){return(-d+Math.log(a))/e},a:Math.exp(d),b:e,mse:function(){return mse(p,a)}}},linearRegression=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return g=a.length,b=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)h=a[b],d.push(h[0]);return d}(),c=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)h=a[b],d.push(h[1]);return d}(),j=b.map(function(a){return a*a}),n=sum(c),k=sum(j),l=sum(b),m=sum(function(){var a,d;for(d=[],f=a=0;g>=0?g>a:a>g;f=g>=0?++a:--a)d.push(b[f]*c[f]);return d}()),i=l*l,d=(n*k-l*m)/(g*k-i),e=(g*m-l*n)/(g*k-i),{y:function(a){return d+e*a},x:function(a){return(a-d)/e},a:d,b:e}},powerLawModel=function(a,b){return{y:function(c){return a*Math.pow(c,b)},x:function(c){return Math.pow(c/a,1/b)},a:a,b:b}},powerLawRegression=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;return j=a.length,b=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)k=a[b],d.push(k[0]);return d}(),c=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)k=a[b],d.push(k[1]);return d}(),g=b.map(Math.log),h=c.map(Math.log),n=sum(function(){var a,b;for(b=[],f=a=0;j>=0?j>a:a>j;f=j>=0?++a:--a)b.push(g[f]*h[f]);return b}()),m=sum(g),o=sum(h),p=sum(g.map(function(a){return a*a})),l=m*m,e=(j*n-m*o)/(j*p-l),d=(o-e*m)/j,i=powerLawModel(Math.exp(d),e),i.mse=function(){return mse(_y,a)},i},fixedPointPowerLawRegression=function(a,b){var c,d,e,f,g,h,i,j,k,l;return i=a.length,j=b[0],l=b[1],g=Math.log(l),c=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)k=a[b],d.push(Math.log(k[0]/j));return d}(),d=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)k=a[b],d.push(Math.log(k[1])-g);return d}(),e=linearRegressionThroughOrigin(function(){var a,b;for(b=[],f=a=0;i>=0?i>a:a>i;f=i>=0?++a:--a)b.push([c[f],d[f]]);return b}()).b,h=powerLawModel(l/Math.pow(j,e),e)},linearRegressionThroughOrigin=function(a){var b,c,d,e,f,g,h,i;return f=a.length,b=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)g=a[b],d.push(g[0]);return d}(),c=function(){var b,c,d;for(d=[],b=0,c=a.length;c>b;b++)g=a[b],d.push(g[1]);return d}(),i=sum(function(){var a,d;for(d=[],e=a=0;f>=0?f>a:a>f;e=f>=0?++a:--a)d.push(b[e]*c[e]);return d}()),h=sum(b.map(function(a){return a*a})),d=i/h,{y:function(a){return d*a},x:function(a){return a/d},b:d}},"undefined"!=typeof module&&null!==module&&(module.exports={SM:this.SM,_test:{exponentialRegression:exponentialRegression,linearRegression:linearRegression,powerLawRegression:powerLawRegression,fixedPointPowerLawRegression:fixedPointPowerLawRegression,linearRegressionThroughOrigin:linearRegressionThroughOrigin}}),main=function(_this){return function(){var data,fs,gotoEnterance,mode,sm;return fs=require("fs"),console.log("(a)add, (n)next, (N)next advanceably, (s)save, (l)load, (e)exit"),mode=["entrance"],data=null,sm=new _this.SM,gotoEnterance=function(){return mode=["entrance"],data=null,process.stdout.write("sm> ")},process.stdin.on("readable",function(){var buf,chunk,g,input,item;switch(chunk=process.stdin.read(),input=null!=chunk?chunk.toString().trim():void 0,mode[0]){case"entrance":switch(input){case"a":case"add":mode=["add"];break;case"n":case"next":mode=["next"];break;case"N":case"Next":mode=["next","_adv"];break;case"s":case"save":mode=["save"];break;case"l":case"load":mode=["load"];break;case"e":case"exit":mode=["exit"];break;case"eval":mode=["eval"];break;case"list":mode=["list"];break;default:gotoEnterance()}}switch(mode[0]){case"add":switch(mode[1]){case void 0:return data={front:null,back:null},console.log("Enter the front of the new card:"),mode[1]="front";case"front":return data.front=input,console.log("Enter the back of the new card:"),mode[1]="back";case"back":return data.back=input,sm.addItem(data),gotoEnterance()}break;case"next":switch(mode[1]){case void 0:case"_adv":return data=sm.nextItem("_adv"===mode[1]),null==data?(console.log("There is no card"+(sm.q.length>0?' that can be shown now. The next card is due at "'+sm.q[0].dueDate.toLocaleString()+'".':".")),gotoEnterance()):(console.log("How much do you remember ["+data.value.front+"]:"),mode[1]="review");case"review":return g=parseInt(input),g>=0&&5>=g?(sm.answer(g,data),console.log("The answer was ["+data.value.back+"]."),gotoEnterance()):"D"===input?(sm.discard(data),gotoEnterance()):console.log("The value should be from '0' (bad) to '5' (good). Otherwise 'D' to discard:")}break;case"save":return null==mode[1]?(console.log("enter file name to save configuration. (default name is [data.json]):"),mode[1]=!0):(""===input&&(input="data.json"),fs.writeFileSync(input,JSON.stringify(sm.data())),gotoEnterance());case"load":return null==mode[1]?(console.log("enter file name to load configuration. (default name is [data.json]):"),mode[1]=!0):(""===input&&(input="data.json"),buf=fs.readFileSync(input),data=JSON.parse(buf.toString()),sm=_this.SM.load(data),gotoEnterance());case"exit":if(null==mode[1])return process.stdin.pause(),mode[1]="paused";break;case"eval":return null==mode[1]?mode[1]=!0:(console.log(eval(input)),gotoEnterance());case"list":return console.log(function(){var a,b,c,d;for(c=sm.q,d=[],a=0,b=c.length;b>a;a++)item=c[a],d.push(JSON.stringify(item.data()));return d}()),gotoEnterance()}})}}(this);try{"undefined"!=typeof module&&null!==module&&("undefined"!=typeof require&&null!==require?require.main:void 0)===module&&main()
}catch(_error){error=_error,console.error("An error occured: "+error)}}.call(this);